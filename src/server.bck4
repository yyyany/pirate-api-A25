import express from 'express';
import swaggerUi from 'swagger-ui-express';
import yaml from 'js-yaml';
//import fs from 'fs';
import path from 'path';
import https from 'https';

const app = express();
const PORT = 2223;

// ðŸ” Chemins vers les certificats SSL gÃ©nÃ©rÃ©s par Certbot
const sslOptions = {
  key: fs.readFileSync('/etc/letsencrypt/live/alaindube.com/privkey.pem'),
  cert: fs.readFileSync('/etc/letsencrypt/live/alaindube.com/fullchain.pem'),
};

// ðŸ“„ Charger le fichier Swagger YAML
const swaggerPath = path.join(__dirname, './swagger.yml');
const swaggerDocument = yaml.load(fs.readFileSync(swaggerPath, 'utf8'));

// ðŸš€ Servir Swagger sur /swagger
app.use('/swagger', swaggerUi.serve, swaggerUi.setup(swaggerDocument));

// ðŸ§ª Route de test simple
app.get('/hello', (req, res) => {
  res.json({ message: 'ðŸ‘‹ Hello depuis Pirate API en HTTPS !' });
});

// ðŸ” DÃ©marrer le serveur HTTPS
https.createServer(sslOptions, app).listen(PORT, () => {
  console.log(`âœ… Swagger disponible sur https://alaindube.com:${PORT}/swagger`);
});
